<!DOCTYPE html>
<html>

<body>
    <h1>Sync App</h1>


    <input type="text" id="newName">

    <button onclick="addItem()">Add</button>
    <button onclick="updateItem()">Update Id 1</button>

    <ul id="root"></ul>

    <script src="./syncDbClient.js"></script>

    <script>

        const root = document.getElementById("root");


        const syncClient = new SyncDbClient('http://localhost:3000/db');
        const localDb = new LocalDbClient(syncClient);

        localDb.onUpdated = () => {
            loadData("ea");
        }

        async function addItem() {
            await localDb.save("ea", [{ id: new Date().getTime(), name: document.getElementById("newName").value }]);
            document.getElementById("newName").value = '';
        }

        async function updateItem() {
            await localDb.update("ea", [{ id: 1, name: document.getElementById("newName").value }]);
            document.getElementById("newName").value = '';
        }

        async function loadData(type) {
            var data = await localDb.get("ea");
            root.innerHTML = '';

            data.forEach(element => {

                const li = document.createElement('li');
                li.textContent = element.name;

                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'Delete';
                deleteButton.onclick = function () {
                    localDb.delete('ea', element.id);
                };
                li.appendChild(deleteButton)

                root.appendChild(li);

            });
        }

        (async () => {

            setTimeout(async () => {

                await localDb.sync('ea');
                loadData("ea");
            }, 500);

        })();



    </script>
</body>

</html>